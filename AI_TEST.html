<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Integration Test - Vital-X</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 32px;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .test-section h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }

        .status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .test-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .test-item h3 {
            font-size: 16px;
            color: #333;
            margin-bottom: 8px;
        }

        .test-result {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin-top: 10px;
        }

        .success-icon {
            color: #28a745;
        }

        .error-icon {
            color: #dc3545;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box p {
            color: #0d47a1;
            margin: 0;
            line-height: 1.6;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ü§ñ AI Integration Test</h1>
        <p class="subtitle">Testing Google Gemini AI integration for Vital-X</p>

        <div class="info-box">
            <p><strong>üìã Test Purpose:</strong> This page verifies that the AI service is properly configured and can
                communicate with Google Gemini API.</p>
        </div>

        <div class="test-section">
            <h2>
                <span>1. Configuration Check</span>
                <span class="status pending" id="config-status">Pending</span>
            </h2>
            <div id="config-results"></div>
        </div>

        <div class="test-section">
            <h2>
                <span>2. AI Service Initialization</span>
                <span class="status pending" id="service-status">Pending</span>
            </h2>
            <div id="service-results"></div>
        </div>

        <div class="test-section">
            <h2>
                <span>3. API Connection Test</span>
                <span class="status pending" id="api-status">Pending</span>
            </h2>
            <div id="api-results"></div>
            <button id="test-api-btn" style="margin-top: 15px;">Test API Connection</button>
        </div>

        <div class="test-section">
            <h2>
                <span>4. Chat Function Test</span>
                <span class="status pending" id="chat-status">Pending</span>
            </h2>
            <div id="chat-results"></div>
            <button id="test-chat-btn" style="margin-top: 15px;" disabled>Test Chat Function</button>
        </div>
    </div>

    <!-- Load AI Configuration and Service -->
    <script src="Vital-X/frontend/backend/config/ai-config.js"></script>
    <script src="Vital-X/frontend/backend/services/ai-service.js"></script>

    <script>
        // Test 1: Configuration Check
        function testConfiguration() {
            const results = document.getElementById('config-results');
            const status = document.getElementById('config-status');

            let html = '';
            let allPassed = true;

            // Check if AI_CONFIG exists
            if (typeof window.AI_CONFIG !== 'undefined') {
                html += `<div class="test-item">
                    <h3>‚úÖ AI_CONFIG loaded</h3>
                    <div class="test-result">Configuration object is available</div>
                </div>`;
            } else {
                html += `<div class="test-item">
                    <h3>‚ùå AI_CONFIG not found</h3>
                    <div class="test-result">Configuration failed to load</div>
                </div>`;
                allPassed = false;
            }

            // Check API key
            if (window.AI_CONFIG && window.AI_CONFIG.apiKey) {
                const keyPreview = window.AI_CONFIG.apiKey.substring(0, 20) + '...';
                html += `<div class="test-item">
                    <h3>‚úÖ API Key configured</h3>
                    <div class="test-result">Key: ${keyPreview}</div>
                </div>`;
            } else {
                html += `<div class="test-item">
                    <h3>‚ùå API Key missing</h3>
                    <div class="test-result">No API key found in configuration</div>
                </div>`;
                allPassed = false;
            }

            // Check model
            if (window.AI_CONFIG && window.AI_CONFIG.model) {
                html += `<div class="test-item">
                    <h3>‚úÖ Model configured</h3>
                    <div class="test-result">Model: ${window.AI_CONFIG.model}</div>
                </div>`;
            }

            results.innerHTML = html;
            status.textContent = allPassed ? 'Passed' : 'Failed';
            status.className = `status ${allPassed ? 'success' : 'error'}`;

            return allPassed;
        }

        // Test 2: AI Service Initialization
        function testServiceInitialization() {
            const results = document.getElementById('service-results');
            const status = document.getElementById('service-status');

            let html = '';
            let allPassed = true;

            // Check if aiService exists
            if (typeof window.aiService !== 'undefined') {
                html += `<div class="test-item">
                    <h3>‚úÖ AI Service initialized</h3>
                    <div class="test-result">window.aiService is available</div>
                </div>`;

                // Check methods
                const methods = ['chat', 'diagnose', 'getRecommendations', 'explainMetric'];
                methods.forEach(method => {
                    if (typeof window.aiService[method] === 'function') {
                        html += `<div class="test-item">
                            <h3>‚úÖ Method: ${method}()</h3>
                            <div class="test-result">Function is available</div>
                        </div>`;
                    } else {
                        html += `<div class="test-item">
                            <h3>‚ùå Method: ${method}()</h3>
                            <div class="test-result">Function not found</div>
                        </div>`;
                        allPassed = false;
                    }
                });
            } else {
                html += `<div class="test-item">
                    <h3>‚ùå AI Service not initialized</h3>
                    <div class="test-result">window.aiService is undefined</div>
                </div>`;
                allPassed = false;
            }

            results.innerHTML = html;
            status.textContent = allPassed ? 'Passed' : 'Failed';
            status.className = `status ${allPassed ? 'success' : 'error'}`;

            return allPassed;
        }

        // Test 3: API Connection
        async function testAPIConnection() {
            const results = document.getElementById('api-results');
            const status = document.getElementById('api-status');
            const btn = document.getElementById('test-api-btn');

            btn.disabled = true;
            btn.textContent = 'Testing...';

            status.textContent = 'Testing';
            status.className = 'status pending';

            try {
                const testPrompt = "Say 'Hello' in one word.";
                const response = await window.aiService.callGeminiAPI(testPrompt);

                results.innerHTML = `
                    <div class="test-item">
                        <h3>‚úÖ API Connection successful</h3>
                        <div class="test-result">
                            <strong>Test Prompt:</strong> "${testPrompt}"<br>
                            <strong>Response:</strong> "${response}"
                        </div>
                    </div>
                `;

                status.textContent = 'Passed';
                status.className = 'status success';

                // Enable chat test
                document.getElementById('test-chat-btn').disabled = false;

                return true;
            } catch (error) {
                results.innerHTML = `
                    <div class="test-item">
                        <h3>‚ùå API Connection failed</h3>
                        <div class="test-result">
                            <strong>Error:</strong> ${error.message}
                            <div class="code">${error.stack || 'No stack trace'}</div>
                        </div>
                    </div>
                `;

                status.textContent = 'Failed';
                status.className = 'status error';

                return false;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Test API Connection';
            }
        }

        // Test 4: Chat Function
        async function testChatFunction() {
            const results = document.getElementById('chat-results');
            const status = document.getElementById('chat-status');
            const btn = document.getElementById('test-chat-btn');

            btn.disabled = true;
            btn.textContent = 'Testing...';

            status.textContent = 'Testing';
            status.className = 'status pending';

            try {
                const testMessage = "What are 3 quick health tips?";
                const response = await window.aiService.chat(testMessage);

                results.innerHTML = `
                    <div class="test-item">
                        <h3>‚úÖ Chat function working</h3>
                        <div class="test-result">
                            <strong>Test Message:</strong> "${testMessage}"<br><br>
                            <strong>AI Response:</strong><br>
                            <div class="code">${response.substring(0, 500)}${response.length > 500 ? '...' : ''}</div>
                        </div>
                    </div>
                `;

                status.textContent = 'Passed';
                status.className = 'status success';

                return true;
            } catch (error) {
                results.innerHTML = `
                    <div class="test-item">
                        <h3>‚ùå Chat function failed</h3>
                        <div class="test-result">
                            <strong>Error:</strong> ${error.message}
                            <div class="code">${error.stack || 'No stack trace'}</div>
                        </div>
                    </div>
                `;

                status.textContent = 'Failed';
                status.className = 'status error';

                return false;
            } finally {
                btn.disabled = false;
                btn.textContent = 'Test Chat Function';
            }
        }

        // Run tests on load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('üß™ Starting AI Integration Tests...');

            // Run synchronous tests
            setTimeout(() => {
                testConfiguration();
                testServiceInitialization();
            }, 100);

            // Setup event listeners
            document.getElementById('test-api-btn').addEventListener('click', testAPIConnection);
            document.getElementById('test-chat-btn').addEventListener('click', testChatFunction);
        });
    </script>
</body>

</html>